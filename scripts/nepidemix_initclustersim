#! python

"""
=============
runsimulation
=============

Create a hierarchy of NepidemiX configuration combinations from an ini file.
The program creates a single run for each possible combination of input
parameter values.

Notes
-----

Experimental and written specifically for the PBS queues at IRMACS. The 
simulation configurations generated by this script may work elsewhere, 
but no guarantees given.

"""

__author__ = "Lukas Ahrenberg <lukas@ahrenberg.se>"

__license__ = "Modified BSD License"

import sys


import nepidemix as nepx

import logging

logger = logging.getLogger(__name__)
nepx.nepidemixlogging.setUpLogging()


if __name__ == "__main__":

    if len(sys.argv) < 2:
        logger.error("Too few arguments.")
        sys.exit("Usage: {0} <config file>".format(sys.argv[0]))
    logger.info("Reading config file: {0}".format(sys.argv[1]))
    settings = nepx.utilities.NepidemiXConfigParser()
    with open(sys.argv[1], 'r') as confFp:        
        settings.readfp(confFp)
    logger.info("Building cluster simulation.")
    sim = nepx.cluster.ClusterSimulation(settings)
    sim.createSimulationConfigs()
    logger.info("Done.")

